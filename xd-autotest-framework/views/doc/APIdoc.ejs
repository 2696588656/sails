<script type="text/javascript" >
  /**
   * Created by lyh on 8/8/16.
   */

  $('#showMdFile').click(function(){
    $.main.refreshMain('/EditDoc/testAPImd');

  });

  $('#addAPIbutton').click(function(){

    var testItem=$("li#api_template").clone(true);
    var apis_count=$("ol#APIs").children('li').length;
    console.log('apis_count=%d',apis_count);
    testItem.find('input#apiTitle_value').attr("id","apiTitle_"+apis_count);
    testItem.find('input#apiURL_value').attr("id","apiURL_"+apis_count);
    testItem.attr('id','api_'+apis_count);
    testItem.attr('style',"display:");
    console.log(testItem);
    $('ol#APIs').prepend(testItem);
    console.log("完成咯~");
    /**
    for(var i=0;i<apis_count;i++){
  }**/

  });

  $('#find_docItem').click(function(){
    $.ajax({
      url: '/doc/findDoc',
      type:"Get",
      //data:"{'first':'蚂蚁部落','second':'欢迎您'}",
      //data:queryString,
      data:{},
      success:function(data){
        //返回的数据用data.d获取内容
        //alert(data.d);
        $("textarea#textarea_response").val(JSON.stringify(data,null,"\t"));
      },
      error:function(err){
        //alert(err);
        $("textarea#textarea_response").val(JSON.stringify(err,null,"\t"));
      }
    });
  });


  /**
   * 根据输入的requestName查询requestItem记录
   * */
  $('#findReqItem').click(function(){
    //var queryString="newLogin";
    var queryString=$('input#input_requestName').val();

    console.log(" test ... :queryString="+queryString);

    $.ajax({
      url: '/doc/findRequestItemByName',
      type:"Get",
      //data:"{'first':'蚂蚁部落','second':'欢迎您'}",
      //data:queryString,
      data:{
        requestName: queryString,
        //a: $('#a').val(),
        //b: $('#b').val()
      },
      success:function(data){
        //返回的数据用data.d获取内容
        //alert(data.d);
        $("textarea#textarea_response").val(JSON.stringify(data,null,"\t"));
      },
      error:function(err){
        //alert(err);
        $("textarea#textarea_response").val(JSON.stringify(err,null,"\t"));
      }
    });

    console.log("execute done service (/doc/findRequestItemByName) via ajax... this should be seen on front...");

  });

  /**
   * 插入equestItem记录
   * */
  $('#test_insertrequestitem').click(function(){
    //var requestItem=JSON.stringify($('textarea#textarea_requestItem').val());
    console.log("requestItem="+$('textarea#textarea_requestItem').val());
    var requestItemValue=$('textarea#textarea_requestItem').val();
    console.log(requestItemValue);
    var requestItem=JSON.parse(requestItemValue);
    console.log(requestItem);
    $.ajax({
      url: "/doc/insertRequestItemService",
      type: "Post",
      data: {
        req: requestItem
      },
      dataType: "urlencoded",
      contentType: 'application/x-www-form-urlencoded;charset=utf-8',
      success: function (data) {
        //返回的数据用data.d获取内容
        //alert(data.d);
        $("textarea#textarea_response").val(JSON.stringify(data,null,"\t"));
      },
      error: function (err) {
        //alert(err);
        $("textarea#textarea_response").val(JSON.stringify(err,null,"\t"));
      }
    });
    console.log("execute done service (/doc/insertRequestItemService) via ajax... this should be seen on front...");
  });

  $('#delete_reqItemTable').click(function(){
    $.ajax({
      url:"/doc/deleteAllReqItem",
      type:"Get",
      data:{},
      success:function(data){
        console.log(data);
        var retmsg={retcode:0,retdesc:"sucess",data:data};
        $("textarea#textarea_response").val(JSON.stringify(retmsg,null,"\t"));
      },
      error:function(err){
        console.log(err);
        var retmsg={retcode:-1,retdesc:"error",data:data};
        $("textarea#textarea_response").val(JSON.stringify(retmsg,null,4));
      }
    });
  });

  /**
   * 将用户的输入存md文件中。
   * */
  $('#save_doc').click(function() {
    var file_name = $('h1#docName').val()+'.md';
    var file_content = $('#md_filecontent').val();
    var param={'filename':file_name, 'filecontent':file_content};
    var queryString=JSON.parse(JSON.stringify(param));
    console.log(param);
    console.log("JSON.stringify(param)="+JSON.stringify(param));

    $.ajax({
      url: "/doc/savedoc",
      type: "Post",
      dataType: "json",
      data: JSON.stringify(param),
      contentType: "application/json;charset=utf-8",
      success: function (data) {
        $('textarea#textarea_response').val(JSON.stringify(data, null, "\t"));
      },
      err: function (data) {
        $('#textarea_response').val(JSON.stringify(err, null, "\t"));
      }
    })
  });

  /**
   * 将用户的输入存入doc与docItem中。
   * */
  $('#save_doc_2_db').click(function(){
    /** 创建文档对象 **/
    var file_name = $('input#docName').val()+'.md';
    var doc_desc=$('input#docdesc').val();
    var test_env=$('input#testenv').val();
    var test_env_port=$('input#testenv_port').val();
    var doc={id:"",name:file_name, testEnv:test_env, testEnvPort:test_env_port, docDesc:doc_desc};

    /** 创建接口对象数组 **/
    var apis_count=$("ol#APIs").children("li[id!='api_template']").length;
    var apis=$("ol#APIs").children("li[id!='api_template']").clone();
    var apiArray = new Array();
    apiArray=$("ol#APIs").children("li[id!='api_template']").clone();
    for(var i=0;i<apis_count;i++){
      apiArray[i].find("input[name='api'").val();
      var api_name=apis[i].clone().find('input[name="api"').val();
      var api_url=apis[i].clone().find('input[name="URL"').val();
      apiArray[i]={name:api_name, url:api_url, APIdocID:""};
    }

    var _jsonParam={api_doc:doc,api_items:apiArray};

    $.ajax({
      url:'/doc/savedocwithItem',
      method:"Post",
      dataType:"json",
      contentType: "application/json;charset=utf-8",
      data: JSON.stringify(_jsonParam),
      success:function(data){
        $('textarea#textarea_response').val(JSON.stringify(data, null, "\t"));
      },
      err:function(err){
        $('textarea#textarea_response').val(JSON.stringify(err, null, "\t"));
      }

    });
  });

  $('#find_doc').click(function(){
    var queryString=$('#docName').val()+'.md';
    console.log(queryString);

    $.ajax({
      url: '/doc/findDocByName',
      type:"Get",
      //data:"{'first':'蚂蚁部落','second':'欢迎您'}",
      //data:queryString,
      data:{
        docName: queryString,
        //a: $('#a').val(),
        //b: $('#b').val()
      },
      success:function(data){
        //返回的数据用data.d获取内容
        //alert(data.d);
        $("textarea#textarea_response").val(JSON.stringify(data,null,"\t"));
      },
      error:function(err){
        //alert(err);
        $("textarea#textarea_response").val(JSON.stringify(err,null,"\t"));
      }
    })

  });

  $('#create_doc').click(function(){
    var queryString=$('#docName').val()+'.md';
    console.log(queryString);

    $.ajax({
      url: '/doc/findDocByName',
      type:"Get",
      //data:"{'first':'蚂蚁部落','second':'欢迎您'}",
      //data:queryString,
      data:{
        docName: queryString,
        //a: $('#a').val(),
        //b: $('#b').val()
      },
      success:function(data){
        //返回的数据用data.d获取内容
        //alert(data.d);
        $("textarea#textarea_response").val(JSON.stringify(data,null,"\t"));
      },
      error:function(err){
        //alert(err);
        $("textarea#textarea_response").val(JSON.stringify(err,null,"\t"));
      }
    })

  });


</script>

<!--左边目录 --->
<ul class="nav navbar-nav side-nav">
  <li>
    <button type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal" id="addtestcase" style="width: 225px;height: auto">添加用例</button>
  </li>
  <li>
    <a href="javascript:void(0)" data-toggle="collapse" data-target="#test_1" style="display:block">
      <i class="fa fa-fw fa-arrows-v"></i> 一级目录?<i class="fa fa-fw fa-caret-up"></i>
    </a>
    <ul data-toggle="collapse" id="test_1">
      <li>
        <a href="javascript:void(0)"  id="test123" >二级目录??</a>
      </li>
      <li>
        <a href="javascript:void(0)"  id="test1234" >二级目录??</a>
      </li>
    </ul>
  </li>

</ul>

<!--右边文档内容-->
<div id="page-wrapper-right" aria-hidden="false" class="right-operation">
<!-- Page Heading -->
<div class="row" >
  <div class="col-lg-12">
    <h1 class="page-header" id="docName">
      业务接口文档
    </h1>
    <ol class="breadcrumb">
      <li>
        <i class="fa fa-dashboard"></i>  文档描述
        <input id="docdesc" value="暂无文档描述" />
      </li>
      <li>
        <i class="fa fa-dashboard"></i>  测试环境
        <input id="testenv" value="192.168.103.101" />
      </li>
      <li class="inactive">
        <!--<i class="fa fa-edit"></i> 端口号 -->
        <i class="fa fa-dashboard"></i> 端口号
        <input id="testenv_port" value="具体接口端口号不同" />
      </li>
    </ol>
  </div>
</div>

<div class="row" >
  <div class="col-lg-6">
    <form role="form">
      <ol id="APIs">
        <li id="api_1">
          <i class="fa fa-edit" id="api_1_apiTitle">接口</i>
          <div >
            <label>接口名</label>
            <input id="api_1_apiTitleValue" class="form-control" />
          </div>
          <div class="form-group">
            <label>URL</label>
            <input class="form-control" placeholder="Enter text" name="">
          </div>
          <div class="form-group" >
            <label>输入完整的requestItem json格式的字符串内容:</label>
            <textarea id="textarea_requestItem" class="form-control" style="visibility:hidden" placeholder="Enter text" rows="2" >{
    "id":"6",
    "dev":"lidehong",
    "disabled":false,
    "name":"HOME6",
    "url":"http://192.168.103.101:8020/selftaught/home",
    "queryParam":{
        "req":""
    },
    "version":"1.0.0",
    "description":"test !!!",
    "method":"POST",
    "headers":{
        "module":"2",
        "clientType":"iOS",
        "version":"1.0.0",
        "clientIp":"127.0.0.1",
        "deviceId":"testDeviceId123456",
        "sessionToken":"token123"
    },
    "mode":"urlencoded",
    "response":""
}
            </textarea>
          </div>
        </li>
        <li id="api_2">
          <i class="fa fa-edit" id="home_api">接口</i>
          <div class="form-group">
            <label>接口名</label>
            <input class="form-control" name="api">
          </div>
          <div class="form-group">
            <label>URL</label>
            <input class="form-control" placeholder="Enter text" name="URL"/>
          </div>
        </li>
        <li id="api_3">
          <i class="fa fa-edit" id="">接口</i>
          <div class="form-group">
            <label>接口名</label>
            <input class="form-control" id="test_api" />
          </div>
          <div class="form-group">
            <label>URL</label>
            <input class="form-control" placeholder="Enter text" id="apiURL_value" />
          </div>
        </li>
        <li id="api_template" style="display: none">
          <i class="fa fa-edit" id="apiTitle">接口</i>
          <div class="form-group">
            <label>接口名</label>
            <input class="form-control" id="apiTitle_value" />
          </div>
          <div class="form-group">
            <label>URL</label>
            <input class="form-control" placeholder="Enter text" id="apiURL_value" />
          </div>
        </li>

      </ol>
    </form>
  </div>
</div>

<div class="row">
  <div class="col-lg-6">
    <form role="form">
      <div class="form-group">
        <label>输入指定RequestItem的name:</label>
        <input id="input_requestName" class="form-control">
      </div>
      <div class="btn btn-default" id="showMdFile">展示md文件</div>
      <div class="btn btn-default" id="addAPIbutton">增加API接口</div>
      <div class="btn btn-default" id="save_doc_2_db">保存文档2db</div>
      <div class="btn btn-default" text="主要效果" id="save_doc">保存文档</div>
    </form>
  </div>
</div>

<div class="row">
  <div class="col-lg-6">
    <form role="form">
      <div class="form-group" >
        <label>执行结果:</label>
        <textarea id="textarea_response" class="form-control" placeholder="操作执行的结果" rows="25"></textarea>
      </div>
    </form>
  </div>
</div>

</div>

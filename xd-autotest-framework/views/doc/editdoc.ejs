<!-- 文档基本信息 -->
  <div class="row" >
      <div class="col-lg-12">
        <h1 class="page-header" id="api_doc_name" uniqid="<%=api_docs.uniqID%>"><%=api_docs.name%></h1>
        <ol class="breadcrumb">
          <li>
            <i class="fa fa-dashboard"></i>文档描述
            <input name="docdesc" value="<%=api_docs.docDesc%>" />
          </li>
          <li>
            <i class="fa fa-dashboard"></i>测试环境
            <input name="testEnv" value="<%=api_docs.testEnv%>" />
          </li>
          <li>
            <i class="fa fa-dashboard"></i>端口号
            <input name="testEnvPort" value="<%=api_docs.testEnvPort%>" />
          </li>
        </ol>
      </div>
    </div>


  <!-- 按钮 -->
  <div class="row">
      <div class="col-lg-6">
      <div class="btn btn-info" id="addAPIbutton">增加API接口</div>
      <div class="btn btn-default" id="save_doc_2_db">保存文档</div>
    </div>
    </div>
  <!-- 所有接口内容 -->
  <div class="row" >
      <div class="col-lg-8">
          <input name="apis_count" type="hidden" value="<%=api_docs.APIdoc_items.length%>" />
          <ol id="APIs" reversed>
            <!-- 实际接口内容 -->
            <%for(var i=0;i<api_docs.APIdoc_items.length;i++){%>
            <li id="<%='api_'+(i+1)%>" uniqid="<%=api_docs.APIdoc_items[i].uniqID%>" >
              <i class="fa fa-edit" id="apiTitle" type="button" >接口</i>
              <button type="button" class="fa fa-edit" aria-hidden="false">编辑</button>
              <div type="button" class="close" aria-hidden="true">×</div>
              <div class="form-group">
                <label class="control-label">接口名</label>
                  <!--<input type="text" class="form-control" id="inputEmail" placeholder="Email">-->
                <input name="api_title" required="required" class="form-control" id="<%='api_title_'+(i+1)%>"
                         value="<%=api_docs.APIdoc_items[i].name%>" />
              </div>
              <div class="form-group">
                <label>接口请求URL</label>
                <input name="api_url" required="required" class="form-control"  id="<%='api_url_'+(i+1)%>"
                       value="<%=api_docs.APIdoc_items[i].url%>"/>
              </div>
              <div class="form-group">
                <label>接口请求方式method</label>
                <!--<input name="api_method" class="form-control" id="<%='api_method_'+(i+1)%>"-->
                       <!--value="<%=api_docs.APIdoc_items[i].method%>"/>-->
                <select class="form-control" name="api_method" text="<%=api_docs.APIdoc_items[i].method%>">
                  <option value="POST" >POST</option>
                  <option value="GET">GET</option>
                </select>
              </div>
              <div class="form-group">
                <label>接口是否废弃disabled</label>
                <!--<input name="api_disabled" class="form-control"  id="<%='api_disabled_'+(i+1)%>"-->
                       <!--value="<%=api_docs.APIdoc_items[i].disabled%>"/>-->
                <select class="form-control" name="api_disabled" text="<%=api_docs.APIdoc_items[i].disabled%>">
                  <option value="false">false</option>
                  <option value="true">true</option>
                </select>
              </div>
              <div class="form-group">
                <label>开发dev</label>
                <select  id="selectDev" class="form-control" name="api_dev" text="<%=api_docs.APIdoc_items[i].dev%>" >
                  <option value="赵聃" >赵聃</option>
                  <option value="李德洪">李德洪</option>
                  <option value="周欢">周欢</option>
                </select>
              </div>
              <div class="form-group">
                <label>接口请求格式content-type</label>
                <!--<input name="api_dataType" class="form-control" id="<%='api_dataType_'+(i+1)%>"-->
                       <!--value="<%=api_docs.APIdoc_items[i].dataType%>"/>-->
                <select class="form-control" name="api_dataType" text="<%=api_docs.APIdoc_items[i].dataType%>">
                  <option value="application/json">application/json</option>
                  <option value="application/x-www-form-urlencoded">application/x-www-form-urlencoded</option>
                  <option value="application/application/octet-stream">application/application/octet-stream</option>
                  <option value="text/html">text/html</option>
                  <option value="text/plain">text/plain</option>
                  <option value="text/xml">text/xml</option>
                  <option value="image/gif">image/gif</option>
                  <option value="image/jpeg">image/jpeg</option>
                  <option value="image/png">image/png</option>
                </select>
              </div>
              <div class="form-group">
                <label>请求头header</label>
                <!--<textarea name="api_header" rows="8" class="form-control" id="<%='api_header_'+(i+1)%>"><%=JSON.stringify(api_docs.APIdoc_items[i].header,null,"\t")%></textarea>-->
                <div id="<%='jsoneditor_header_'+(i+1)%>" style="width:auto; height:auto;"
                     content='<%=JSON.stringify(api_docs.APIdoc_items[i].header,null)%>'></div>
              </div>
              <div class="form-group">
                <label>请求参数queryParams</label>
                <!--<textarea name="api_queryParams" class="form-control" id="<%='api_queryParams_'+(i+1)%>"-->
                          <!--content='<%=JSON.stringify(api_docs.APIdoc_items[i].queryParams,null)%>'><%=JSON.stringify(api_docs.APIdoc_items[i].queryParams,null)%></textarea>-->
                <div id="<%='jsoneditor_queryParams_'+(i+1)%>" style="width:auto; height:auto;"
                     content='<%=JSON.stringify(api_docs.APIdoc_items[i].queryParams,null)%>'></div>
              </div>
              <div class="form-group">
                <label>返回结果response</label>
                <!--<textarea name="api_response" rows="8" class="form-control" id="<%='api_response_'+(i+1)%>"><%=JSON.stringify(api_docs.APIdoc_items[i].response,null,"\t")%></textarea>-->
                <div id="<%='jsoneditor_response_'+(i+1)%>" style="width:auto; height:auto;"
                     content='<%=JSON.stringify(api_docs.APIdoc_items[i].response,null)%>'></div>
              </div>
            </li>
            <%}%>

            <!-- api模板 -->
            <li id="api_template" uniqid="" style="display: none">
              <i class="fa fa-edit" id="apiTitle" >接口</i>
              <div type="button" class="close" data-dismiss="modal" aria-hidden="true">×</div>
              <div class="form-group">
                <label class="control-label" style="text-align:right">接口名</label>
                <input name="api_title" class="form-control"/>
              </div>
              <div class="form-group">
                <label class="control-label">URL</label>
                <input name="api_url" class="form-control"/>
              </div>
              <div class="form-group">
                <label class="control-label">请求method</label>
                <!--<input name="api_method" class="form-control"  />-->
                <select class="form-control" name="api_method">
                  <option value="POST" selected="selected">POST</option>
                  <option value="GET">GET</option>
                </select>
              </div>
              <div class="form-group">
                <label class="control-label">接口是否废弃disabled</label>
                <!--<input name="api_disabled" class="form-control" />-->
                <select class="form-control" name="api_disabled">
                  <option value="false">false</option>
                  <option value="true">true</option>
                </select>
              </div>
              <div class="form-group">
                <label class="control-label">开发dev</label>
                <select class="form-control" name="api_dev" >
                  <option value="赵聃">赵聃</option>
                  <option value="李德洪">李德洪</option>
                  <option value="周欢">周欢</option>

                </select>
              </div>
              <div class="form-group">
                <label class="control-label">请求content-type</label>
                <!--<input name="api_dataType" class="form-control" />-->
                <select class="form-control" name="api_dataType" >
                  <option value="application/json" style=" ">application/json</option>
                  <option value="application/x-www-form-urlencoded">application/x-www-form-urlencoded</option>
                  <option value="application/application/octet-stream">application/application/octet-stream</option>
                  <option value="text/html">text/html</option>
                  <option value="text/plain">text/plain</option>
                  <option value="text/xml">text/xml</option>
                  <option value="image/gif">image/gif</option>
                  <option value="image/jpeg">image/jpeg</option>
                  <option value="image/png">image/png</option>
                </select>
              </div>
              <div class="form-group">
                <label class="control-label">请求头header</label>
                <button id="header_kv_add" class="fa fa-plus" data-dismiss="modal" aria-hidden="true"></button>
                <div name="jsoneditor_header_" style="width: auto; height: auto;"></div>
                <ol id="api_header_kv" style="display: none">
                  <li id="header_kv_1" >
                    <input placeholder="key" required="required" />
                    <input placeholder="value" />
                    <input placeholder="字段名描述" />
                    <div type="button" class="close" data-dismiss="modal" aria-hidden="true">×</div>
                  </li>
                </ol>
              </div>
              <div class="form-group">
                <label class="control-label">请求参数</label>
                <button id="params_kv_add" class="fa fa-plus" data-dismiss="modal" aria-hidden="true"></button>
                <div name="jsoneditor_queryParams_" style="width: auto; height: auto;"></div>
              </div>
              <div class="form-group">
                <label class="control-label">返回结果Response</label>
                <div name="jsoneditor_response_" style="width: auto; height: auto;"></div>
              </div>
            </li>
          </ol>
      </div>
    </div>


<link href="/xd-autotest-framework/css/jsoneditor.css" rel="stylesheet" type="text/css">
<script src="/xd-autotest-framework/js/jsoneditor.js"></script>
<script src="/xd-autotest-framework/js/docs/editdoc.js"></script>

<!-- 添加jsoneditor -->
<script>

  function createJSONeditor(container_id, json){
    //var container = document.getElementById('jsoneditor_queryParams_'+(i+1));
    var container=document.getElementById(container_id);

    var options = {
      mode: 'code',
      modes: ['code', 'form', 'text', 'tree', 'view'], // allowed modes
      onError: function (err) {
        alert(err.toString());
      },
      onModeChange: function (newMode, oldMode) {
        console.log('Mode switched from', oldMode, 'to', newMode);
      }
    };

    var editor_temp = new JSONEditor(container, options, json);
    editor_temp.set(json);
    return editor_temp;
  }

  var temp_container_id='jsoneditor_1';
  var temp_json1={"name":"jsoneditor_1"};

  var temp_editor=createJSONeditor(temp_container_id,temp_json1);

  var container2=document.getElementById('jsoneditor_2');
  temp_editor.container=container2;
  temp_editor.con
  temp_editor.set({"name":"jsoneditor_2"});


  var header_jsoneditors=new Array();
  var queryParams_jsoneditors=new Array();
  var response_jsoneditors=new Array();

  var array_length=document.getElementById('APIs').childElementCount-1;
  for(var i=0;i<array_length;i++){
    //添加header的jsoneditors.
    var header_container_id='jsoneditor_header_'+(i+1);
    var header_json=JSON.parse($('#'+header_container_id).attr('content'));
    var header_editor_temp=createJSONeditor(header_container_id,header_json);
    header_jsoneditors.push(header_editor_temp);

    //添加queryParmas的jsoneditor.
    var param_container_id='jsoneditor_queryParams_'+(i+1);
    var param_json=JSON.parse($('#'+param_container_id).attr('content'));
    var param_editor_temp=createJSONeditor(param_container_id,param_json);
    queryParams_jsoneditors.push(param_editor_temp);

    //添加response的jsoneditor.
    var response_container_id='jsoneditor_response_'+(i+1);
    var response_json=JSON.parse($('#'+response_container_id).attr('content'));
    var response_editor_temp=createJSONeditor(response_container_id,response_json);
    response_jsoneditors.push(response_editor_temp);

  }

  console.log("end****** jsoneditors.push(ALL);");
</script>


<li id="kv_template" style="display: none">
   <input placeholder="key" required="required"/>
   <input placeholder="value" />
   <input placeholder="字段名描述" />
   <div type="button" class="close" data-dismiss="modal" aria-hidden="true">×</div>
 </li>
<div id="jsoneditor_1" style="height: auto;width: auto"></div>
<div id="jsoneditor_2" style="height: auto;width: auto"></div>
<div id="jsoneditor_3" style="height: auto;width: auto"></div>



